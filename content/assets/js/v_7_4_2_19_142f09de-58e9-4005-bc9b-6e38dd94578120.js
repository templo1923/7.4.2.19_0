import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578122.js";import{u as T,f as y,i as E,r as U,a as F,b as C,c as h,S as L,d as M,e as A,g as k,h as v,j as R,k as D,l as I,m as P,n as W,o as $,p as w,q as G,s as O,t as _,v as j,w as N,x,I as B}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578123.js";import{i as q,a as z}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578119.js";import{u as J}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578124.js";import{E as K,R as H,P as g}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578110.js";import{i as Q,a as V}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578125.js";import{i as X}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578126.js";import{i as Y}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578127.js";import{i as Z}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578128.js";import{i as tt}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578129.js";import{i as et}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578130.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578131.js";import{s as ot}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578132.js";import{i as at}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578133.js";import{i as st}from"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578134.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457817.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457814.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd945781.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457816.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457818.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457815.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578118.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457819.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457812.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd9457813.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578135.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578136.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578137.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578138.js";import"./v_7_4_2_19_142f09de-58e9-4005-bc9b-6e38dd94578139.js";const it=()=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("whatsapp/index.iife.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.remove()}},rt=(t,e,r=5e3)=>{const n=Date.now(),p=()=>{document.querySelector(t)?e():Date.now()-n>=r?(console.error(`Erro: O seletor "${t}" não foi encontrado dentro do tempo limite.`),e()):setTimeout(p,300)};p()};rt("#app .app-wrapper-web",()=>{it()});async function nt(t,e){return new Promise((r,n)=>{const p=indexedDB.open(t,1);p.onerror=function(s){console.error("Erro ao abrir o banco de dados."),n("Erro ao abrir o banco de dados.")},p.onupgradeneeded=function(s){s.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},p.onsuccess=function(s){const c=s.target.result,o=c.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=function(){r(o.result),c.close()},o.onerror=function(){console.error("Erro ao ler os dados da tabela."),n("Erro ao ler os dados da tabela.")}}})}const ct=async()=>{const t=!location.href.includes("https://web.whatsapp");let e=[];if(t)e=await K({stopPropag:!1,action:"getOrderLabels",waitForResponse:!0});else{const r=await nt("useOrderLabels","orderLabels");r[0]&&(e=r[0])}J.setState({orderLabels:e})},dt=async()=>{const t=await H("crm");T.setState({crm:t})};ct();dt();(async()=>(await y(),await E(),q(),U.getState().getNotificaoes(),F()))();function pt(t,e){const r=[],n=[],p=new Set(e.flatMap(a=>a.chats.map(o=>`${o.id}|${a.id}`))),s=new Set(t.flatMap(a=>a.chats.map(o=>`${o.id}|${a.id}`))),c=new Map(e.flatMap(a=>a.chats.map(o=>[`${o.id}|${a.id}`,{chat:o,tabId:a.id}]))),l=new Map(t.flatMap(a=>a.chats.map(o=>[`${o.id}|${a.id}`,{chat:o,tabId:a.id}])));for(const a of s)if(!p.has(a)){const o=l.get(a);o&&r.push({...o,chat:{...o.chat,id:g(o.chat.id)}})}for(const a of p)if(!s.has(a)){const o=c.get(a);o&&n.push({...o,chat:{...o.chat,id:g(o.chat.id)}})}return{chatsAdded:r,chatsRemoved:n}}async function b(t,e,r){for(const{chat:n,tabId:p}of t){const s=e.filter(c=>{var m,i,d;const l=c.funil.abas.some(u=>u.id===p),a=n.id.endsWith("@g.us"),o=((d=(i=(m=c.regras)==null?void 0:m.responderGrupos)==null?void 0:i.propriedades)==null?void 0:d.active)!==!1;return l&&c.acionamento.type===r&&(!a||o)});for(const c of s)try{await L(n.id,c)}catch(l){console.error(`❌ Erro ao disparar follow-up: ${c.id} para chat: ${n.id}`,l)}}}function lt(t,e){t.forEach(({chat:r,tabId:n})=>{e.filter(s=>{var o,m,i;const c=s.funil.abas.some(d=>d.id===n),l=r.id.endsWith("@g.us"),a=((i=(m=(o=s.regras)==null?void 0:o.responderGrupos)==null?void 0:m.propriedades)==null?void 0:i.active)!==!1;return c&&s.acionamento.type==="timing"&&(!l||a)}).forEach(s=>{h.getState().addChatToFollowUp(s.id,n,r,"tab")})})}function mt(t,e){t.forEach(({chat:r,tabId:n})=>{e.filter(s=>{var o,m,i;const c=s.funil.abas.some(d=>d.id===n),l=r.id.endsWith("@g.us"),a=((i=(m=(o=s.regras)==null?void 0:o.responderGrupos)==null?void 0:m.propriedades)==null?void 0:i.active)!==!1;return c&&s.acionamento.type==="timing"&&(!l||a)}).forEach(s=>{h.getState().removeChatFromFollowUp(s.id,n,r.id,"tab")})})}function ut(){return C.subscribe(async(e,r)=>{if(!e.userTabs||!h.getState().initSubscribeUserTabs)return;const n=e.userTabs||[],p=r.userTabs||[],s=h.getState().FollowUp.filter(i=>i.active);if(s.length===0)return;const c=p.filter(i=>!n.some(d=>d.id===i.id)),{chatsAdded:l,chatsRemoved:a}=pt(n,p),o=c.flatMap(i=>i.chats.map(d=>({chat:d,tabId:i.id}))),m=a.filter(i=>!o.some(d=>d.chat.id===i.chat.id));if(l.length>0){const i=s.filter(u=>u.acionamento.type==="dispararAoEntrar"),d=s.filter(u=>u.acionamento.type==="timing");i.length>0&&await b(l,i,"dispararAoEntrar"),d.length>0&&lt(l,d)}if(m.length>0){const i=s.filter(f=>f.acionamento.type==="dispararAoSair"),d=m.filter(f=>!c.some(S=>S.id===f.tabId));i.length>0&&d.length>0&&await b(d,i,"dispararAoSair");const u=s.filter(f=>f.acionamento.type==="timing");u.length>0&&mt(m,u)}})}window.addEventListener("message",t=>{if(t.data.type==="Ev"&&t.data.action==="chat.update_label"){const e=JSON.parse(t.data.model);if(!e.chat||!e.chat.id)return;e.chat.id={server:"@"+e.chat.id.split("@")[1],user:e.chat.id.split("@")[0],_serialized:e.chat.id},M.getState().dispartWebhook(e.chat.id.user,"labels",{labels:e.labels,type:e.type})}t.data.type==="Ev"&&t.data.action==="chat.presence_change"&&JSON.parse(t.data.model)});A();k();Q();V();v();R();X();Y();Z();tt();D();I();P();et();W();ut();ot({useUserLogin:$,useModal:w,useModalOptions:G});O.subscribe(({label:t})=>{chrome.storage.local.get(["initSystem","userTabs","guardaMsg"],e=>{if(!e.initSystem&&e.userTabs.length===0&&e.guardaMsg.length===0){const{openRendertype:r}=w.getState();t.webhook_login_clients.length!==0?r("ModalLeads",!1,void 0,!0):t.chromeStoreID!=="ahiieliljkcgmghicbgidblclkbklmka"&&t.chromeStoreID!=="likkccegmkoonimkjnmgpadngedknpdk"&&r("Modelo_Selecao",!1)}})});window.addEventListener("message",async t=>{t.data.type==="Ev"&&t.data.action==="webpack.full_ready"&&(_(),j(),await z(),at(),await N(),x(),st(),B())});
